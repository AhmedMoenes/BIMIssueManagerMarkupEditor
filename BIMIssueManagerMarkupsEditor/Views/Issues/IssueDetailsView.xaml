<hc:Window x:Class="BIMIssueManagerMarkupsEditor.Views.Issues.IssueDetailsView"
           xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
           xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
           xmlns:hc="https://handyorg.github.io/handycontrol"
           xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
           xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
           xmlns:converters="clr-namespace:BIMIssueManagerMarkupsEditor.Converters"
           mc:Ignorable="d"
           Title="Issue Details"
           Width="960" Height="640"
           WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <converters:InverseBoolConverter x:Key="InverseBoolConverter" />
        <converters:BoolToColorConverter x:Key="BoolToColorConverter" />
    </Window.Resources>

    <Grid Background="#FAFAFA">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Title + Buttons -->
            <RowDefinition Height="Auto"/>
            <!-- Details + Snapshot -->
            <RowDefinition Height="Auto"/>
            <!-- Divider -->
            <RowDefinition Height="*"/>
            <!-- Description + Comments -->
        </Grid.RowDefinitions>

        <!-- 🔹 Title & Action Buttons -->
        <DockPanel Grid.Row="0" LastChildFill="False" Margin="10">
            <TextBlock Text="{Binding Issue.Title}"
                       FontSize="26"
                       FontWeight="Bold"
                       Foreground="#222"
                       VerticalAlignment="Center"
                       DockPanel.Dock="Left"
                       Margin="0,0,20,0"/>
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" DockPanel.Dock="Right">
                <Button Command="{Binding MarkAsResolvedCommand}"
                        IsEnabled="{Binding Issue.IsResolved, Converter={StaticResource InverseBoolConverter}}"
                        Style="{StaticResource ButtonPrimary}" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <Path Width="16" Height="16"
                              Fill="White"
                              Stretch="Uniform"
                              Margin="0,0,8,0"
                              Data="{StaticResource Resolved}"/>
                        <TextBlock Text="Mark as Resolved" VerticalAlignment="Center" Foreground="White"/>
                    </StackPanel>
                </Button>

                <Button Command="{Binding EditIssueCommand}"
                        Style="{StaticResource ButtonPrimary}" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <Path Width="16" Height="16"
                              Fill="White"
                              Stretch="Uniform"
                              Margin="0,0,8,0"
                              Data="{StaticResource Edit}"/>
                        <TextBlock Text="Edit" VerticalAlignment="Center" Foreground="White"/>
                    </StackPanel>
                </Button>

                <Button Command="{Binding DeleteIssueCommand}"
                        Style="{StaticResource ButtonDanger}" Margin="5">
                    <StackPanel Orientation="Horizontal">
                        <Path Width="16" Height="16"
                              Fill="White"
                              Stretch="Uniform"
                              Margin="0,0,8,0"
                              Data="{StaticResource Delete}"/>
                        <TextBlock Text="Delete" VerticalAlignment="Center" Foreground="White"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </DockPanel>

        <!-- 🔹 Details & Snapshot -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>

            <!-- 📋 Details -->
            <StackPanel Grid.Column="0" Margin="0">
                <StackPanel Orientation="Vertical">
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="📁 Project:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.ProjectName}" Foreground="#555"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="👤 Created By:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.CreatedByUser}" Foreground="#555"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="🧑‍💻 Assigned To:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.AssignedToUser}" Foreground="#555"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="⚡ Priority:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.Priority}" Foreground="#0078D7"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="🕒 Created At:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" Foreground="#555"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="✔ Resolved:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.IsResolved}" Foreground="{Binding Issue.IsResolved, Converter={StaticResource BoolToColorConverter}}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8">
                        <TextBlock Text="📌 Area:" FontWeight="Bold" Width="100"/>
                        <TextBlock Text="{Binding Issue.Area.AreaName}" Foreground="#555"/>
                    </StackPanel>
                </StackPanel>

                <!-- 🏷 Labels inline -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="0,10,0,4">
                    <TextBlock Text="🏷 Labels:" FontWeight="SemiBold" VerticalAlignment="Center" Width="100"/>
                    <ItemsControl ItemsSource="{Binding Issue.Labels}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel VerticalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#DDD" Margin="2" Padding="6,2" CornerRadius="4">
                                    <TextBlock Text="{Binding LabelName}" />
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </StackPanel>

            <!-- 📷 Snapshot -->
            <StackPanel Grid.Column="1">
                <TextBlock Text="📷 Snapshot:" FontWeight="SemiBold" FontSize="14" Margin="0,0,0,4"/>
                <Border BorderBrush="#AAA" BorderThickness="1" CornerRadius="6" Margin="0 6 0 0">
                    <Image Source="{Binding Issue.ImagePath}"
                           hc:Magnifier.Instance="{x:Static hc:Magnifier.Default}"
                           Width="400" Height="220"
                           Stretch="UniformToFill"
                           Margin="4"/>
                </Border>
            </StackPanel>
        </Grid>

        <!-- 🔹 Divider -->
        <hc:Divider Grid.Row="2" LineStrokeThickness="1" Margin="0"/>

        <!-- 🔹 Description & Comments -->
        <Grid Grid.Row="3" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" />
                <ColumnDefinition Width="auto"/>
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0">
                <TextBlock Text="📝 Description:" FontWeight="SemiBold" FontSize="14"/>
                <TextBlock Text="{Binding Issue.Description}" TextWrapping="Wrap" Margin="4" Foreground="#444"/>
            </StackPanel>
            <hc:Divider Grid.Column="1" LineStrokeThickness="2" Orientation="Vertical" Margin="0"/>
            <StackPanel Grid.Column="2">
                
                <TextBlock Text="💬 Comments:" FontWeight="SemiBold" Margin="4,0,0,0" FontSize="14"/>
                <ItemsControl ItemsSource="{Binding Issue.Comments}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="White" BorderBrush="#CCC" BorderThickness="1" CornerRadius="4" Margin="4" Padding="6">
                                <StackPanel>
                                    <TextBlock Text="{Binding Message}" TextWrapping="Wrap" />
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <TextBlock Text="{Binding CreatedBy}" FontStyle="Italic" FontSize="11" Foreground="Gray"/>
                                        <TextBlock Text=" • " FontSize="11" Foreground="Gray"/>
                                        <TextBlock Text="{Binding CreatedAt, StringFormat='{}{0:yyyy-MM-dd HH:mm}'}" FontSize="11" Foreground="Gray"/>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </StackPanel>
        </Grid>
    </Grid>
</hc:Window>
